{"version":3,"sources":["../../src/view/area.js"],"names":["Area","Emitter","constructor","container","emitter","k","x","y","el","document","createElement","style","transformOrigin","_zoom","Zoom","onZoom","bind","_drag","Drag","onTranslate","onStart","on","destroy","addEventListener","pointermove","update","t","transform","e","clientX","clientY","rect","getBoundingClientRect","left","top","mouse","trigger","_startPosition","dx","dy","translating","translate","delta","ox","oy","sourceSource","zoom","source","params","d","appendChild","removeChild"],"mappings":"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","sourcesContent":["import { Drag } from './drag.js';\nimport { Emitter } from '../core.js';\nimport { Zoom } from './zoom.js';\n\n\nexport class Area extends Emitter {\n\n    el;\n    container;\n    transform = { k: 1, x: 0, y: 0 };\n    mouse = { x: 0, y: 0 }\n\n    _startPosition = null\n    _zoom;\n    _drag;\n\n    constructor(container, emitter) {\n        super(emitter);\n\n        const el = this.el = document.createElement('div');\n\n        this.container = container;\n        el.style.transformOrigin = '0 0';\n\n        this._zoom = new Zoom(container, el, 0.1, this.onZoom.bind(this));\n        this._drag = new Drag(container, this.onTranslate.bind(this), this.onStart.bind(this));\n\n        emitter.on('destroy', () => {\n            this._zoom.destroy();\n            this._drag.destroy();\n        });\n\n        this.container.addEventListener('pointermove', this.pointermove.bind(this));\n\n        this.update();\n    }\n\n    update() {\n        const t = this.transform;\n\n        this.el.style.transform = `translate(${t.x}px, ${t.y}px) scale(${t.k})`;\n    }\n\n    pointermove(e) {\n        const { clientX, clientY } = e;\n        const rect = this.el.getBoundingClientRect();\n        const x = clientX - rect.left;\n        const y = clientY - rect.top;\n        const k = this.transform.k;\n\n        this.mouse = { x: x / k, y: y / k };\n        this.trigger('mousemove', { ...this.mouse }); // TODO rename on `pointermove`\n    }\n\n    onStart() {\n        this._startPosition = { ...this.transform };\n    }\n\n    onTranslate(dx, dy) {\n        if (this._zoom.translating) return; // lock translation while zoom on multitouch\n        if (this._startPosition) this.translate(this._startPosition.x + dx, this._startPosition.y + dy);\n    }\n\n    onZoom(delta, ox, oy, sourceSource) {\n        this.zoom(this.transform.k * (1 + delta), ox, oy, source);\n\n        this.update();\n    }\n\n    translate(x, y) {\n        const params = { transform: this.transform, x, y };\n\n        if (!this.trigger('translate', params)) return;\n\n        this.transform.x = params.x;\n        this.transform.y = params.y;\n\n        this.update();\n        this.trigger('translated');\n    }\n\n    zoom(zoom, ox = 0, oy = 0, sourceSource) {\n        const k = this.transform.k;\n        const params = { transform: this.transform, zoom, source };\n\n        if (!this.trigger('zoom', params)) return;\n\n        const d = (k - params.zoom) / ((k - zoom) || 1);\n\n        this.transform.k = params.zoom || 1;\n        this.transform.x += ox * d;\n        this.transform.y += oy * d;\n\n        this.update();\n        this.trigger('zoomed', { source });\n    }\n\n    appendChild(el) {\n        this.el.appendChild(el)\n    }\n\n    removeChild(el) {\n        this.el.removeChild(el)\n    }\n}"],"file":"area.js"}