{"version":3,"sources":["../../src/view/index.js"],"names":["EditorView","Emitter","constructor","container","components","emitter","Map","style","overflow","addEventListener","click","bind","e","trigger","view","on","resize","nodes","forEach","destroy","updateConnections","area","Area","appendChild","el","addNode","node","component","get","name","Error","nodeView","NodeView","set","removeNode","delete","removeChild","addConnection","connection","input","output","viewInput","viewOutput","connView","ConnectionView","connections","removeConnection","getConnections","conn","update","parentElement","width","clientWidth","height","clientHeight","target"],"mappings":"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","sourcesContent":["import { Area } from './area.js';\nimport { ConnectionView } from './connection.js';\nimport { Emitter } from '../core.js';\nimport { NodeView } from './node.js';\nimport { listenWindow } from './utils.js';\n\n\nexport class EditorView extends Emitter {\n\n    container;\n    components;\n    nodes = new Map();\n    connections = new Map();\n    area;\n\n    constructor(container, components, emitter) {\n        super(emitter);\n\n        this.container = container;\n        this.components = components;\n\n        this.container.style.overflow = 'hidden';\n\n        this.container.addEventListener('click', this.click.bind(this));\n        this.container.addEventListener('contextmenu', e => this.trigger('contextmenu', { e, view: this }));\n        emitter.on('destroy', listenWindow('resize', this.resize.bind(this)));\n        emitter.on('destroy', () => this.nodes.forEach(view => view.destroy()));\n\n        this.on('nodetranslated', this.updateConnections.bind(this));\n\n        this.area = new Area(container, this);\n        this.container.appendChild(this.area.el);\n    }\n\n    addNode(node) {\n        const component = this.components.get(node.name);\n\n        if (!component) throw new Error(`Component ${node.name} not found`);\n\n        const nodeView = new NodeView(node, component, this);\n\n        this.nodes.set(node, nodeView);\n        this.area.appendChild(nodeView.el);\n    }\n\n    removeNode(node) {\n        const nodeView = this.nodes.get(node);\n\n        this.nodes.delete(node);\n        if (nodeView) {\n            this.area.removeChild(nodeView.el);\n            nodeView.destroy();\n        }\n    }\n\n    addConnection(connection) {\n        if (!connection.input.node || !connection.output.node)\n            throw new Error('Connection input or output not added to node');\n\n        const viewInput = this.nodes.get(connection.input.node);\n        const viewOutput = this.nodes.get(connection.output.node);\n\n        if (!viewInput || !viewOutput)\n            throw new Error('View node not found for input or output');\n\n        const connView = new ConnectionView(connection, viewInput, viewOutput, this);\n\n        this.connections.set(connection, connView);\n        this.area.appendChild(connView.el);\n    }\n\n    removeConnection(connection) {\n        const connView = this.connections.get(connection);\n\n        this.connections.delete(connection);\n        if (connView)\n            this.area.removeChild(connView.el);\n    }\n\n    updateConnections({ node }) {\n        node.getConnections().forEach(conn => {\n            let connView = this.connections.get(conn);\n\n            if (!connView) throw new Error('Connection view not found');\n\n            connView.update();\n        });\n    }\n\n    resize() {\n        const { container } = this;\n\n        if (!container.parentElement)\n            throw new Error('Container doesn\\'t have parent element');\n\n        const width = container.parentElement.clientWidth;\n        const height = container.parentElement.clientHeight;\n\n        container.style.width = width + 'px';\n        container.style.height = height + 'px';\n    }\n\n    click(e) {\n        const container = this.container;\n\n        if (container !== e.target) return;\n        if (!this.trigger('click', { e, container })) return;\n    }\n}"],"file":"index.js"}