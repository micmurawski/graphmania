{"version":3,"sources":["../../src/view/drag.js"],"names":["Drag","constructor","el","onTranslate","_x","_y","_e","onStart","onDrag","pointerStart","style","touchAction","addEventListener","down","bind","destroyMove","move","destroyUp","up","destroy","e","pointerType","button","stopPropagation","pageX","pageY","preventDefault","x","y","delta","zoom","getBoundingClientRect","width","offsetWidth"],"mappings":";;;;;;;AAAA;;;;AAEO,MAAMA,IAAN,CAAW;AAMdC,EAAAA,WAAW,CACPC,EADO,EAKT;AAAA,QAHEC,WAGF,uEAHgB,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,KAAgB,CAAG,CAGnC;AAAA,QAFEC,OAEF,uEAFaD,EAAD,IAAQ,CAAG,CAEvB;AAAA,QADEE,MACF,uEADYF,EAAD,IAAQ,CAAG,CACtB;;AAAA,0CATa,IASb;;AAAA,gCARG,IAQH;;AAAA,qCAPQ,MAAM;AAAE;AAAS,KAOzB;;AACE,SAAKG,YAAL,GAAoB,IAApB;AACA,SAAKP,EAAL,GAAUA,EAAV;AAEA,SAAKA,EAAL,CAAQQ,KAAR,CAAcC,WAAd,GAA4B,MAA5B;AACA,SAAKT,EAAL,CAAQU,gBAAR,CAAyB,aAAzB,EAAwC,KAAKC,IAAL,CAAUC,IAAV,CAAe,IAAf,CAAxC;AAEA,QAAMC,WAAW,GAAG,yBAAa,aAAb,EAA4B,KAAKC,IAAL,CAAUF,IAAV,CAAe,IAAf,CAA5B,CAApB;AACA,QAAMG,SAAS,GAAG,yBAAa,WAAb,EAA0B,KAAKC,EAAL,CAAQJ,IAAR,CAAa,IAAb,CAA1B,CAAlB;;AAEA,SAAKK,OAAL,GAAe,MAAM;AAAEJ,MAAAA,WAAW;AAAIE,MAAAA,SAAS;AAAK,KAApD;AACH;;AAEDJ,EAAAA,IAAI,CAACO,CAAD,EAAI;AACJ,QAAKA,CAAC,CAACC,WAAF,KAAkB,OAAnB,IAAgCD,CAAC,CAACE,MAAF,KAAa,CAAjD,EAAqD;AACrDF,IAAAA,CAAC,CAACG,eAAF;AACA,SAAKd,YAAL,GAAoB,CAACW,CAAC,CAACI,KAAH,EAAUJ,CAAC,CAACK,KAAZ,CAApB;AAEA,SAAKlB,OAAL,CAAaa,CAAb;AACH;;AAEDJ,EAAAA,IAAI,CAACI,CAAD,EAAI;AACJ,QAAI,CAAC,KAAKX,YAAV,EAAwB;AACxBW,IAAAA,CAAC,CAACM,cAAF;AAEA,QAAI,CAACC,CAAD,EAAIC,CAAJ,IAAS,CAACR,CAAC,CAACI,KAAH,EAAUJ,CAAC,CAACK,KAAZ,CAAb;AAEA,QAAII,KAAK,GAAG,CAACF,CAAC,GAAG,KAAKlB,YAAL,CAAkB,CAAlB,CAAL,EAA2BmB,CAAC,GAAG,KAAKnB,YAAL,CAAkB,CAAlB,CAA/B,CAAZ;AAEA,QAAIqB,IAAI,GAAG,KAAK5B,EAAL,CAAQ6B,qBAAR,GAAgCC,KAAhC,GAAwC,KAAK9B,EAAL,CAAQ+B,WAA3D;AAEA,SAAK9B,WAAL,CAAiB0B,KAAK,CAAC,CAAD,CAAL,GAAWC,IAA5B,EAAkCD,KAAK,CAAC,CAAD,CAAL,GAAWC,IAA7C,EAAmDV,CAAnD;AACH;;AAEDF,EAAAA,EAAE,CAACE,CAAD,EAAI;AACF,QAAI,CAAC,KAAKX,YAAV,EAAwB;AAExB,SAAKA,YAAL,GAAoB,IAApB;AACA,SAAKD,MAAL,CAAYY,CAAZ;AACH;;AAlDa","sourcesContent":["import { listenWindow } from './utils.js';\n\nexport class Drag {\n\n    pointerStart = null;\n    el = null;\n    destroy = () => { return; };\n\n    constructor(\n        el,\n        onTranslate = (_x, _y, _e) => { },\n        onStart = (_e) => { },\n        onDrag = (_e) => { }\n    ) {\n        this.pointerStart = null;\n        this.el = el;\n\n        this.el.style.touchAction = 'none';\n        this.el.addEventListener('pointerdown', this.down.bind(this));\n\n        const destroyMove = listenWindow('pointermove', this.move.bind(this));\n        const destroyUp = listenWindow('pointerup', this.up.bind(this));\n\n        this.destroy = () => { destroyMove(); destroyUp(); }\n    }\n\n    down(e) {\n        if ((e.pointerType === 'mouse') && (e.button !== 0)) return;\n        e.stopPropagation();\n        this.pointerStart = [e.pageX, e.pageY]\n\n        this.onStart(e);\n    }\n\n    move(e) {\n        if (!this.pointerStart) return;\n        e.preventDefault();\n\n        let [x, y] = [e.pageX, e.pageY]\n\n        let delta = [x - this.pointerStart[0], y - this.pointerStart[1]];\n\n        let zoom = this.el.getBoundingClientRect().width / this.el.offsetWidth;\n\n        this.onTranslate(delta[0] / zoom, delta[1] / zoom, e);\n    }\n\n    up(e) {\n        if (!this.pointerStart) return;\n\n        this.pointerStart = null;\n        this.onDrag(e);\n    }\n}"],"file":"drag.js"}