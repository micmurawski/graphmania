{"version":3,"sources":["../../src/view/zoom.js"],"names":["Zoom","constructor","container","el","intensity","onzoom","addEventListener","wheel","bind","down","dblclick","destroyMove","move","destroyUp","end","destroyCancel","destroy","translating","pointers","length","e","preventDefault","rect","getBoundingClientRect","wheelDelta","delta","deltaY","ox","left","clientX","oy","top","clientY","touches","x1","y1","x2","y2","distance","Math","sqrt","pow","cx","cy","push","map","p","pointerId","previous","filter"],"mappings":"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","sourcesContent":["import { listenWindow } from './utils.js';\n\n\nexport class Zoom {\n\n    el;\n    intensity;\n    onzoom;\n    previous = null;\n\n    pointers = [];\n    destroy = () => { };\n\n    constructor(container, el, intensity, onzoom) {\n        this.el = el;\n        this.intensity = intensity;\n        this.onzoom = onzoom;\n\n        container.addEventListener('wheel', this.wheel.bind(this));\n        container.addEventListener('pointerdown', this.down.bind(this));\n        container.addEventListener('dblclick', this.dblclick.bind(this));\n\n        const destroyMove = listenWindow('pointermove', this.move.bind(this));\n        const destroyUp = listenWindow('pointerup', this.end.bind(this));\n        const destroyCancel = listenWindow('pointercancel', this.end.bind(this));\n\n        this.destroy = () => { destroyMove(); destroyUp(); destroyCancel(); }\n    }\n\n    get translating() { // is translating while zoom (works on multitouch)\n        return this.pointers.length >= 2;\n    }\n\n    wheel(e) {\n        e.preventDefault();\n\n        const rect = this.el.getBoundingClientRect();\n        const wheelDelta = e.wheelDelta;\n        const delta = (wheelDelta ? wheelDelta / 120 : - e.deltaY / 3) * this.intensity;\n\n        const ox = (rect.left - e.clientX) * delta;\n        const oy = (rect.top - e.clientY) * delta;\n\n        this.onzoom(delta, ox, oy, 'wheel');\n    }\n\n    touches() {\n        let e = { touches: this.pointers }\n        let [x1, y1] = [e.touches[0].clientX, e.touches[0].clientY];\n        let [x2, y2] = [e.touches[1].clientX, e.touches[1].clientY];\n\n        let distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n\n        return {\n            cx: (x1 + x2) / 2,\n            cy: (y1 + y2) / 2,\n            distance\n        };\n    }\n\n    down(e) {\n        this.pointers.push(e);\n    }\n\n    move(e) {\n        this.pointers = this.pointers.map(p => p.pointerId === e.pointerId ? e : p)\n        if (!this.translating) return;\n\n        let rect = this.el.getBoundingClientRect();\n\n        let { cx, cy, distance } = this.touches();\n\n        if (this.previous !== null) {\n            let delta = distance / this.previous.distance - 1;\n\n            const ox = (rect.left - cx) * delta;\n            const oy = (rect.top - cy) * delta;\n\n            this.onzoom(delta, ox - (this.previous.cx - cx), oy - (this.previous.cy - cy), 'touch');\n        }\n        this.previous = { cx, cy, distance };\n    }\n\n    end(e) {\n        this.previous = null;\n        this.pointers = this.pointers.filter(p => p.pointerId !== e.pointerId)\n    }\n\n    dblclick(e) {\n        e.preventDefault();\n\n        const rect = this.el.getBoundingClientRect();\n        const delta = 4 * this.intensity;\n\n        const ox = (rect.left - e.clientX) * delta;\n        const oy = (rect.top - e.clientY) * delta;\n\n        this.onzoom(delta, ox, oy, 'dblclick');\n    }\n}\n"],"file":"zoom.js"}