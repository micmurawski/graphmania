{"version":3,"sources":["../../src/view/area.js"],"names":["Drag","Emitter","Zoom","Area","constructor","container","emitter","k","x","y","el","document","createElement","style","transformOrigin","_zoom","onZoom","bind","_drag","onTranslate","onStart","on","destroy","addEventListener","pointermove","update","t","transform","e","clientX","clientY","rect","getBoundingClientRect","left","top","mouse","trigger","_startPosition","dx","dy","translating","translate","delta","ox","oy","sourceSource","zoom","source","params","d","appendChild","removeChild"],"mappings":"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","sourcesContent":["import { Drag } from './drag.js';\nimport { Emitter } from '../core.js';\nimport { Zoom } from './zoom.js';\n\n\nexport class Area extends Emitter {\n\n    el;\n    container;\n    transform = { k: 1, x: 0, y: 0 };\n    mouse = { x: 0, y: 0 }\n\n    _startPosition = null\n    _zoom;\n    _drag;\n\n    constructor(container, emitter) {\n        super(emitter);\n\n        const el = this.el = document.createElement('div');\n\n        this.container = container;\n        el.style.transformOrigin = '0 0';\n\n        this._zoom = new Zoom(container, el, 0.1, this.onZoom.bind(this));\n        this._drag = new Drag(container, this.onTranslate.bind(this), this.onStart.bind(this));\n\n        emitter.on('destroy', () => {\n            this._zoom.destroy();\n            this._drag.destroy();\n        });\n\n        this.container.addEventListener('pointermove', this.pointermove.bind(this));\n\n        this.update();\n    }\n\n    update() {\n        const t = this.transform;\n\n        this.el.style.transform = `translate(${t.x}px, ${t.y}px) scale(${t.k})`;\n    }\n\n    pointermove(e) {\n        const { clientX, clientY } = e;\n        const rect = this.el.getBoundingClientRect();\n        const x = clientX - rect.left;\n        const y = clientY - rect.top;\n        const k = this.transform.k;\n\n        this.mouse = { x: x / k, y: y / k };\n        this.trigger('mousemove', { ...this.mouse }); // TODO rename on `pointermove`\n    }\n\n    onStart() {\n        this._startPosition = { ...this.transform };\n    }\n\n    onTranslate(dx, dy) {\n        if (this._zoom.translating) return; // lock translation while zoom on multitouch\n        if (this._startPosition) this.translate(this._startPosition.x + dx, this._startPosition.y + dy);\n    }\n\n    onZoom(delta, ox, oy, sourceSource) {\n        this.zoom(this.transform.k * (1 + delta), ox, oy, source);\n\n        this.update();\n    }\n\n    translate(x, y) {\n        const params = { transform: this.transform, x, y };\n\n        if (!this.trigger('translate', params)) return;\n\n        this.transform.x = params.x;\n        this.transform.y = params.y;\n\n        this.update();\n        this.trigger('translated');\n    }\n\n    zoom(zoom, ox = 0, oy = 0, sourceSource) {\n        const k = this.transform.k;\n        const params = { transform: this.transform, zoom, source };\n\n        if (!this.trigger('zoom', params)) return;\n\n        const d = (k - params.zoom) / ((k - zoom) || 1);\n\n        this.transform.k = params.zoom || 1;\n        this.transform.x += ox * d;\n        this.transform.y += oy * d;\n\n        this.update();\n        this.trigger('zoomed', { source });\n    }\n\n    appendChild(el) {\n        this.el.appendChild(el)\n    }\n\n    removeChild(el) {\n        this.el.removeChild(el)\n    }\n}"],"file":"area.js"}